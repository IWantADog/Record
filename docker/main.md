# docker

## 需要回答的问题
- [ ] docker和虚拟化技术之间的区别
- [x] docker run中--link的用法
  - link可将不同container之间的网络连接起来
- [x] docker run中--entrypoint的用法
  - default command to execute at runtime

## 1

### 什么是docker

docker使用的是linux namespace和cgroups

docker容器隔离包含8个方面
- pid命名空间：进程标识符和能力
- UTS命名空间：主机名和域名
- MNT命名空间：文件系统访问和结构
- IPC命名空间：通过共享内存的进程间通信
- NET命名空间：网络访问和结构
- USR命名空间：用户名和标识
- chroot()：控制文件系统根目录的位置
- croups： 资源保护

## 2

### 消除源数据冲突

docker create --cpid: 通过cpid文件创建container，

`docker run`与`docker create`的区别

## 3

docker load/docker save
将镜像导出为文件

## 4 持久化存储和卷间状态共享

将主机的文件系统挂载到容器中，这样及时容器被删除后，数据依然不会丢失。

docker中提供了两种挂载卷
- 绑定挂载卷：由用户指定主机上需要到容器上的文件位置
- docker管理存储卷：有docker自行确定数据存储在主机上的位置，仅需要提供容器中的挂载路径

`--volumes-from`: 将其他容器中挂载的卷也同样挂载到当前容器。不过volumes-from也有一些限制：
- 不能修改容器中的挂载
- 当多个容器中的挂载点相同时，挂载点会冲突，无法获取完整的数据
- 无法修改挂载点的读写权限

## 5 网络访问

docker提供了四种容器的配置，隔离程度从高到低依次为:
- close
- joined
- bridge
- open

通过`--net`来进行设置

### close

无法与容器外部的网络通信，仅能访问容器内部接口

### bridge

可以连接到容器外的网络，同时也可以访问内部接口

通过`-p/-P/--expose`将容器的端口与主机的端口建立映射

### join

使多个容器之间共享网络接口。*可以理解为将多个容器在网络层面融合，将其视为一个容器。*

### open

直接与主机的网络相连

### include

将不同容器在网络层面链接起来。使用include时必须被连接的容器必须已经存在。

使用include建立的容器之间的连接是*静态的、单向的、不可传递的*。
- 静态：依赖方容器，绑定的是被依赖容器的ip地址，如果ip切换则依赖会无法使用。
- 单向：只能依赖方能访问别依赖方
- 不可传递： 如果A依赖B，B依赖C，但A无法直接访问C

## 6 隔离

### 共享内存

默认情况下docker为每个容器创建一个独立且唯一的IPC命名空间。linux的ipc命名空间共享内存单元。

### 跨容器的进程间通信

使用 *--ipc* 是多个容器共享同一个ipc命名空间。

### 开放内存容器

*--ipc host*：使容器与主机上的其他进程运行在同一个命名空间中，这样容器中的进程就能和主机上的进程进行通信。

## 7 在镜像中打包软件

docker镜像的分层

### 联合文件系统
- 当从联合文件系统中读取一个文件，系统会从存在该文件的最上面一层中读取。如果文件没有在最顶层被创建或者被修改，那么读取操作就会沿着层不断向下找，直到找到存在这个文件的层。
- 当一个文件被删除或修改，一个删除/修改记录就被写入最顶层，它会遮挡底层所有该文件的版本。
- copy-on-write： ？？？？

#### 导入导出扁平文件系统

160




















