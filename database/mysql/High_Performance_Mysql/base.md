# High Performance MySQl

- [x] 3. 服务器性能剖析
- [x] 4. schema于数据类型优化
- [x] 5. 索引
6. 查询数据优化
7. mysql高级特性
8. 优化服务器配置
14. 应用程缓存


## 逻辑架构

```puml

```

## 不同存储引擎的特性
- InnoDB
- MyISAM

95%的情况下都选择InnoDB

## mysql基准测试

sysbench

## 服务性能剖析

- 分析慢查询日志
  - `pt-query-digest`工具
- 剖析单条查询
  - 使用`show profile`
  - 使用`show status`
  - `Performance Schema`
    - 书上不是很推荐，应为写书的时候，该特性还不完善，不知道现在怎么样了
- 确认时单条查询问题还是服务器问题
  - `show global status`每秒获取服务器状态
  - `show processlist`获取线程状态

## 选择优化的数据结构


### 整数类型
- tinyint/smallint/mediumint/int/bigint，分别使用8, 16, 24, 32, 64位存储空间，可以存储的值的范围从`-2 ** (n-1)`到`2 ** (n-1) - 1`

### Blob和Text类型
- blob和text被作为单独的对象进行存储。当blob和text值太大时，InnoDB会使用专门的"外部"存储区域来进行存储，此时每个值在行内需要1-4个字节存储一个指针，然后在外部存储区域存储实际的值。
 
### 缓存表和汇总表

缓存表: 将主表的部分信息写入缓存表中，可以针对特殊查询，创建索引或者选择合适的存储引擎

汇总表: 保存从主表中聚合而来的结果数据

### 物化视图

物化视图实际上时预先计算并存储在磁盘上的表，可以通过各种各样的策略刷新和更新。

### 加快alter table操作的数据

mysql执行大部分修改表结构操作的方法是用新的结构创建一个空表，从旧表中查出所有数据插入新表，然后删除旧表。这种方式在数据量很大，而且存在很多索引的情况下需要花费很长时间。

而且`alter table`操作将导致mysql服务中断。

比较常用的办法有两个
1. 在一台不提供服务的机器上执行alter操作，之后于提供服务的主库进行切换
2. 新建一张和原表相同的表，在该表上进行操作。之后通过重命名和删表交换两张表
