# 微服务设计

## 微服务

### 什么是微服务

微服务是小而自治的服务。

关于小的标准比较模糊，作者给出了两种考虑角度
1. 当不觉的一个代码库过大的时候，他就足够小了（感觉太主观了）
> 代码库也不一味的小。虽然服务越小，越能体会到微服务的优点，但他的缺点--管理众多微服务的问题--也会更加突出。
2. 是否于团队结构相匹配。如果代码库过大，小的团队维护会十分困难。

关于自治性。每个微服务都是独立的，可以单独部署。并且修改一个服务并对其重新部署，不会影响其他服务。

### 微服务的好处

1. 技术异构性。不同的服务可以根据需求选择不同的语言实现。
2. 弹性。便于处理服务不可用问题和服务降级问题。
> 服务降级问题：服务降级一般是指在服务器压力剧增的时候，根据实际业务使用情况以及流量，对一些服务和页面有策略的不处理或者用一种简单的方式进行处理，从而释放服务器资源的资源以保证核心业务的正常高效运行。
3. 扩展。经扩展需要扩展的服务。
4. 简化部署。
5. 与组织结构相匹配。对于小团队，微服务代码更容易维护。
6. 服务可替换性。由于所有的服务都是独立的，对于某存在问题或需优化的服务，可以重新构建而不影响其他服务。


### 正确认识微服务

微服务并不是万能的。他有优点也有相应的缺点--如何管理众多的微服务等缺点。


## 架构师

- 未来的变化难以预料，所以与其对所有可能的变化进行预测，不如做一个允许变化的系统。
- 架构师的职责之一就是保证该系统适合开发人员在其上工作。
- 架构师应该专注在大方向上，只有在有限的情况下参与到非常具体的细节实现上。而且必须保证系统不仅能满足当前的需求，还应能够应对未来的变化。
- 架构师不应该过多关心模块内部如何实现，而应该多关注模块之间的事。
- 做系统设计方面的决定通常都是在取舍。
- 战略目标决定架构原则。架构原则决定设计和实践。
- 制定好的标准
    - 监控。实时获取服务的健康状况。
    - 接口。
    - 架构安全性。（等待后面的章节）
- 代码治理
    - 真实环境中的范例优于干瘪的文字描述。
    - 裁剪服务代码模块。基于开发实践提取通用的代码模版，提高开发速度。
        > 服务代码的模版的主要目的是简化开发工作，如果有将开发工作弄复杂的情况，应该慎重。
- 原则应该可以根据实践的反馈进行修改。
- 谨记小孩学自行车的过程示例。
    > 对于普通情况引导优于控制；对于可能导致严重问题的情况应该及时控制并制止。
    > 不过如何区分普通情况和严重情况十分困难。
- 架构师不仅仅只做技术决定。还要帮助队友成长，使他们理解技术愿景，并保证他们能够积极参与到技术愿景的实现和调整中去。
- 伟大的软件来自伟大的人。
- 如何更好的平衡取舍才是关键。

## 如何建模服务

### 原则及含义
好的微服务需要专注的概念`松耦合`和`高内聚`。

松耦合。简单的理解就是，每个微服务之间不相互依赖，部署一个服务时不会影响到其他的服务。

高内聚。把因相同原因而变化的东西放在一起，把应不同原因而变化的东西分离开。更具体一点是对于一个特性做修改，应该仅修改一处。

### 界限上下文（bounded countext）

- 界限上下文分为两部分，一部分需要与外部通信，另一部分不需要与外部通信。每个上下文都有明确的接口，接口决定了暴露那些内部模型给其他上下文。
- 避免过早划分。过早划分微服务的代价很高。而将一个已有的代码库划分为微服务，要比从头构建简单的多。
- 从功能考虑上下文，而避免仅仅从数据上考虑。
- 逐步划分。先划分大的`界限上下文`，完成之后在考虑将大的拆分为小的。

## 集成

选择集成技术时，首要考虑的问题是--我们希望从这些技术中得到什么？

- 避免破坏性修改。
- 保证API的技术无关性。
- 隐藏内部实现细节。（所有倾向与暴露内部实现细节的技术都不应该被采用，这会形成耦合点）